Bootstrap: docker
From: centos:8
Stage: build

%setup
    mkdir -p ${SINGULARITY_ROOTFS}/opt

%post
    yum install -y which git coreutils-single automake mpich mpich-devel redhat-rpm-config make zlib-devel openssl-devel
    git clone https://github.com/bioinfo-pf-curie/mpiMarkDup.git
    cd mpiMarkDup
    aclocal
    autoconf
    automake --add-missing
    ./configure CC=/usr/lib64/mpich/bin/mpicc --prefix=/opt/mpiMarkDup
    make
    make install

Bootstrap: docker
From: centos:8
Stage: final

%files from build
    /opt/mpiMarkDup /opt/mpiMarkDup

%post
    yum install -y mpich openssl-devel
    yum clean all

%environment
    export LANG=C
    export LC_ALL=C
    export PATH=$PATH:/opt/mpiMarkDup/bin

%runscript
    exec mpiMarkDup "$@"
